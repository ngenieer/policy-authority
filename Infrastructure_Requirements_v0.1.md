# Infrastructure Requirements Specification v0.1 (EN)

## 1. Scope
This specification defines the **minimum executable requirements** for the AI Decision Audit & Enforcement System v0.1.

This version applies **only to infrastructure changes** generated by AI agents.

Included domains:
- Terraform (`.tf`, `.tfplan`, `.tf.json`)
- Kubernetes manifests (`.yaml`, `.yml`)

Excluded domains:
- Application code
- Data logic and migrations
- UI / frontend

---

## 2. System Form
The system SHALL be delivered as a **standalone CLI program**.

The CLI:
- MUST run locally and in CI environments
- MUST NOT require a network connection at decision time
- MAY optionally sync policy snapshots via Git

---

## 3. Inputs

### 3.1 Target Repository
- A Git repository containing infrastructure definitions
- A specific commit or working tree state

### 3.2 Policy Reference
Policy MUST be provided via one of the following:
- `policy.lock` file (recommended)
- CLI argument specifying policy repository URL + commit SHA

Example `policy.lock`:
```
policy_repo=https://github.com/org/policy-authority
policy_ref=8f3a2c9d6c0a8b...
```

---

## 4. Policy Snapshot Structure
A Policy Snapshot MUST consist of:

- `policy_index.yml`
- `rules/`
  - `invariants.yml`
  - `boundaries.yml`
  - `deprecated.yml`
- `sources/`
- Snapshot metadata:
  - policy repository URL
  - commit SHA
  - bundle hash (sha256)
  - optional signature

The snapshot SHALL be treated as immutable.

---

## 5. Execution Flow

1. Load policy snapshot (Git checkout by commit SHA)
2. Compute policy bundle hash
3. Parse infrastructure changes (diff or plan)
4. Apply policy rules deterministically
5. Produce PASS or FAIL
6. Generate verdict artifact

No human input is allowed during execution.

---

## 6. Enforcement Rules (v0.1)

### 6.1 Mandatory FAIL Conditions
The system MUST FAIL if any of the following are detected:

#### Infrastructure Boundary Violations
- Modification of forbidden accounts, namespaces, or environments
- Changes outside declared scope

#### State Regression
- Encryption disabled
- Network exposure widened (e.g. `0.0.0.0/0` ingress)
- IAM permissions widened to wildcard

---

## 7. Verdict Artifact

A verdict artifact MUST be produced for every run.

Minimum required fields:

- `verdict`: PASS | FAIL
- `policy_repo`
- `policy_ref`
- `policy_bundle_hash`
- `target_repo_commit`
- `violations[]`:
  - rule_id
  - file
  - reason
  - evidence

Artifacts MUST be stored locally as files.

---

## 8. Determinism and Reproducibility

Given:
- the same target commit
- the same policy snapshot

The system MUST always produce the same verdict.

---

## 9. Explicit Non-Goals (v0.1)

The system SHALL NOT:
- Suggest fixes
- Auto-remediate changes
- Request human approval
- Maintain user accounts
- Provide dashboards

---

## 10. Success Criteria

This version is considered successful if:
- Infrastructure changes are deterministically accepted or rejected
- Each decision is explainable via a policy snapshot reference
- The system can operate fully offline at execution time

