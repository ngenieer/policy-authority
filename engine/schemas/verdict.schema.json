{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Policy Authority Verdict v0.1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "spec_version",
    "verdict",
    "snapshot",
    "target",
    "violations"
  ],
  "properties": {
    "verdict": {
      "type": "string",
      "enum": [
        "PASS",
        "FAIL"
      ]
    },
    "snapshot": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "hash"
      ],
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "hash": {
          "type": "string",
          "pattern": "^sha256:[A-Fa-f0-9]{64}$"
        }
      }
    },
    "target": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "ref"
      ],
      "properties": {
        "ref": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "violations": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "rule",
          "file",
          "evidence"
        ],
        "properties": {
          "rule": {
            "type": "string",
            "minLength": 1
          },
          "file": {
            "type": "string",
            "minLength": 1
          },
          "evidence": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    },
    "spec_version": {
      "type": "string",
      "enum": [
        "v0.1"
      ],
      "description": "Verdict schema version. Must remain stable for v0.1."
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "verdict": {
            "const": "PASS"
          }
        },
        "required": [
          "verdict"
        ]
      },
      "then": {
        "properties": {
          "violations": {
            "type": "array",
            "maxItems": 0
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "verdict": {
            "const": "FAIL"
          }
        },
        "required": [
          "verdict"
        ]
      },
      "then": {
        "properties": {
          "violations": {
            "type": "array",
            "minItems": 1
          }
        }
      }
    }
  ]
}
