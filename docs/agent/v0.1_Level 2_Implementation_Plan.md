> Status: Completed.
> This document records the constraints and scope used to produce the v0.1 Level 2 Terraform proof.


# v0.1 Level 2 (Terraform) — Implementation Plan

> This document is binding for implementation work.
> Any deviation requires explicit instruction.

## Goal

> **Given identical Terraform input and a fixed Policy Snapshot,**  
> **the system MUST always produce the same PASS/FAIL verdict and evidence.**

This plan defines the *minimum executable proof* required to publicly release **Policy Authority v0.1 (Level 2)** using **Terraform** as the initial reference domain.

---

## 1. Single Execution Path (ONE WAY IN)

**Chosen interface:** CLI (single command)

```bash
bin/policy-authority eval \
  --snapshot snapshots/terraform/snapshot_v0.1 \
  --target examples/target-repos/terraform-pass
```

### Rules

- No additional subcommands
- No automatic snapshot discovery
- No implicit defaults
- No "latest" resolution
- Snapshot and target MUST always be explicit

Execution flow:

```
engine/cli/eval.py
  → engine/core/evaluate.py
```

---

## 2. Snapshot → Target Evaluation (Deterministic Core)

### Inputs

- **Policy Snapshot**
  - `policy_index.yml`
  - `rules/invariants.yml`
  - `rules/boundaries.yml`
  - `rules/deprecated.yml`

- **Target Repository**
  - Terraform repository (plain files only)

### Evaluation Rules

- File glob matching only
- Plain-text substring checks only
- Fixed rule ordering
- Short-circuit on first failure

No:
- AST parsing
- Runtime inspection
- Environment awareness

---

## 3. Verdict Artifact (Fixed Format)

### Output File

```
verdict.json
```

### Minimum Structure (v0.1)

```json
{
  "verdict": "FAIL",
  "snapshot": {
    "id": "terraform/snapshot_v0.1",
    "hash": "sha256:..."
  },
  "target": {
    "path": "examples/target-repos/terraform-fail",
    "ref": "local"
  },
  "violations": [
    {
      "rule": "no-public-s3",
      "file": "main.tf",
      "evidence": "acl = \"public-read\""
    }
  ]
}
```

### Constraints

- PASS / FAIL only
- No explanation text
- No recommendations
- No auto-fix output

---

## 4. Schema Definition (Level 2 Requirement)

### File

```
engine/schemas/verdict.schema.json
```

### Schema Rules

- Explicit field definitions
- Minimal optional fields
- No free-form maps
- Any extension requires version bump

---

## 5. Examples (Proof, Not Tutorial)

### Directory Structure

```
examples/
└── target-repos/
    ├── terraform-pass/
    │   └── main.tf
    └── terraform-fail/
        └── main.tf
```

### Constraints

- PASS and FAIL reasons must be obvious from file contents
- Verdict artifact alone must explain the outcome
- No additional documentation required

---

## 6. Reproducibility Check (Level 2 Core)

### Script

```
scripts/repro_check.sh
```

```bash
for i in 1 2 3; do
  bin/policy-authority eval ... --out verdict_$i.json
done

diff verdict_1.json verdict_2.json
diff verdict_2.json verdict_3.json
```

### Rules

- Any diff is a failure
- No warnings
- No tolerance ranges

---

## 7. README Update (Minimal)

To be added **only at public release**:

```md
## Minimal Execution Proof (Terraform)

```bash
bin/policy-authority eval \
  --snapshot snapshots/terraform/snapshot_v0.1 \
  --target examples/target-repos/terraform-pass
```

Produces a deterministic `verdict.json` (PASS / FAIL only).
```

No additional explanation or tutorial is permitted.

---

## 8. Public Release Criteria (Terraform Level 2)

All conditions below MUST be met:

- [ ] Single CLI execution path exists
- [ ] One PASS and one FAIL Terraform example
- [ ] Deterministic `verdict.json` output
- [ ] Verdict JSON schema present
- [ ] Reproducibility check passes
- [ ] No Web, runtime, or admission logic present

---

## Declaration

> This implementation plan exists to prove that **Policy Authority v0.1 is a mechanical system, not an interpretive one.**

No additional features may be added without invalidating this proof.

